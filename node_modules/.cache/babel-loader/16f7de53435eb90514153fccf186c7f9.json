{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\projects\\\\app-apd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\projects\\\\app-apd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"D:\\\\projects\\\\app-apd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"D:\\\\projects\\\\app-apd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"D:\\\\projects\\\\app-apd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"D:\\\\projects\\\\app-apd\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import qs from\"qs\";import axios from\"axios\";import moment from\"moment\";import Loader from\"react-loader-spinner\";import Alerts from\"../../Components/Alerts\";import{CopyToClipboard}from\"react-copy-to-clipboard\";import{Card,Button,Row,Container,Col,Form}from\"react-bootstrap\";var FinishedPayment=/*#__PURE__*/function(_Component){_inherits(FinishedPayment,_Component);var _super=_createSuper(FinishedPayment);function FinishedPayment(){var _this;_classCallCheck(this,FinishedPayment);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.copyCodeToClipboard=function(text){var el=text;el.select();document.execCommand(\"copy\");};return _this;}_createClass(FinishedPayment,[{key:\"componentDidMount\",value:function componentDidMount(){var data=this.props.states.midtrans_account;var updatePaymentHandler=this.props.simedisPaymentChange;var updateAccountHandler=this.props.simedisAccountChange;//parsing URL\nvar query=qs.parse(this.props.location.search,{ignoreQueryPrefix:true});var loadHandler=this.props.updatePageLoad;loadHandler(true);this.processData(query.order_id,//orderId\nupdatePaymentHandler,updateAccountHandler,loadHandler);}},{key:\"processData\",value:function(){var _processData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(orderId,updatePaymentHandler,updateAccountHandler,loadHandler){var res1,res2,res3;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.getTransactionDetail(orderId,updatePaymentHandler,updateAccountHandler,loadHandler);case 2:res1=_context.sent;_context.next=5;return this.registerPayment(updateAccountHandler,updateAccountHandler,loadHandler);case 5:res2=_context.sent;_context.next=8;return this.getCertificate(updateAccountHandler,loadHandler);case 8:res3=_context.sent;if(res1===true&&res2===true){loadHandler(false);}else{this.failCase(updateAccountHandler,loadHandler);}case 10:case\"end\":return _context.stop();}}},_callee,this);}));function processData(_x,_x2,_x3,_x4){return _processData.apply(this,arguments);}return processData;}()},{key:\"getTransactionDetail\",value:function(){var _getTransactionDetail=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(orderId,updatePaymentHandler,updateAccountHandler,loadHandler){var data,url,config,res,dataTransactionDetail;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:data=this.props.states.midtrans_account;_context2.prev=1;url=process.env.REACT_APP_MIDTRANS_URL+orderId+\"/status\";config={auth:{username:data.server_key,password:\"\"},headers:{Accept:\"application/json\",\"Content-Type\":\"application/json\",Authorization:data.server_key+\":\"}};_context2.next=6;return axios.get(url,config);case 6:res=_context2.sent;if(!(res.status!=200)){_context2.next=10;break;}this.failCase(updateAccountHandler,loadHandler);return _context2.abrupt(\"return\",false);case 10:dataTransactionDetail=res.data;updatePaymentHandler(\"payment_desc\",dataTransactionDetail.payment_type);updatePaymentHandler(\"bill_code\",orderId);updatePaymentHandler(\"payment_ref_code\",dataTransactionDetail.transaction_id);updatePaymentHandler(\"paid_amount\",dataTransactionDetail.gross_amount);updatePaymentHandler(\"transaction_date\",moment(dataTransactionDetail.transaction_time).format(\"YYYY-MM-DD\"));return _context2.abrupt(\"return\",true);case 19:_context2.prev=19;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);return _context2.abrupt(\"return\",false);case 23:case\"end\":return _context2.stop();}}},_callee2,this,[[1,19]]);}));function getTransactionDetail(_x5,_x6,_x7,_x8){return _getTransactionDetail.apply(this,arguments);}return getTransactionDetail;}()},{key:\"registerPayment\",value:function(){var _registerPayment=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(updateAccountHandler,loadHandler){var dataPayment,url,data,res,responseData,members;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:dataPayment=this.props.states.simedis_payment;_context3.prev=1;url=process.env.REACT_APP_PAYMENT_URL;data={paymentDesc:dataPayment.payment_desc,paymentRefCode:dataPayment.bill_code,billCode:dataPayment.bill_code,amount:dataPayment.paid_amount,paidAmount:dataPayment.paid_amount,transactionDate:dataPayment.transaction_date,paymentStatus:true,usedReferralCode:\"\"};_context3.next=6;return axios.post(url,data,\"\");case 6:res=_context3.sent;if(res.data.ok){_context3.next=10;break;}this.failCase(updateAccountHandler,loadHandler);return _context3.abrupt(\"return\",false);case 10:responseData=res.data;members=responseData.data.members[0];updateAccountHandler(\"registration_code\",responseData.data.registrationCode);updateAccountHandler(\"customer_code\",members.data.customer_code);return _context3.abrupt(\"return\",true);case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](1);console.log(_context3.t0);return _context3.abrupt(\"return\",false);case 21:case\"end\":return _context3.stop();}}},_callee3,this,[[1,17]]);}));function registerPayment(_x9,_x10){return _registerPayment.apply(this,arguments);}return registerPayment;}()},{key:\"getCertificate\",value:function(){var _getCertificate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(updateAccountHandler,loadHandler){var accountData,url,data,config,res;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;accountData=this.props.states.simedis_account;url=process.env.REACT_APP_CUSTOMER_POLICIES_CERTIFICATE_URL;data={customerCode:accountData.customer_code,registrationCode:accountData.registration_code};config={headers:{Authorization:accountData.token}};_context4.next=7;return axios.post(url,data,config);case 7:res=_context4.sent;if(res.data.ok){_context4.next=11;break;}this.failCase(updateAccountHandler,loadHandler);return _context4.abrupt(\"return\",false);case 11:updateAccountHandler(\"base64\",res.data.data.data.certificate);return _context4.abrupt(\"return\",true);case 15:_context4.prev=15;_context4.t0=_context4[\"catch\"](0);console.log(_context4.t0);return _context4.abrupt(\"return\",false);case 19:case\"end\":return _context4.stop();}}},_callee4,this,[[0,15]]);}));function getCertificate(_x11,_x12){return _getCertificate.apply(this,arguments);}return getCertificate;}()},{key:\"failCase\",value:function failCase(updateAccountHandler,loadHandler){updateAccountHandler(\"is_valid\",false);updateAccountHandler(\"form_status\",\"Mohon maaf koneksi mengalami kendala, silahkan coba lagi\");loadHandler(false);}},{key:\"render\",value:function render(){var states=this.props.states;var text=\"Bagikan ke teman anda https://bit.ly/30t7Pn3\";if(!states||states.is_loading===true){return/*#__PURE__*/React.createElement(Card,null,/*#__PURE__*/React.createElement(Card.Header,null,\"Loading\"),/*#__PURE__*/React.createElement(Card.Body,null,/*#__PURE__*/React.createElement(Loader,{style:{width:\"100%\",height:\"100\",display:\"flex\",justifyContent:\"center\",alignItems:\"center\"},type:\"ThreeDots\",color:\"#2BAD60\",height:\"100\",width:\"100\"})));}var content;if(states.simedis_account.is_valid===false){content=/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{lg:12,className:\"text-center\"},/*#__PURE__*/React.createElement(Alerts,{data:states.simedis_account,valid:states.simedis_account.is_valid}))));}else{content=/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{lg:12,className:\"text-center\"},\"Pembayaran Telah Selesai, Silahkan Cek Email Yang Anda Daftarkan Untuk Aktivasi Account\")),/*#__PURE__*/React.createElement(Row,{className:\"mt-2\"},/*#__PURE__*/React.createElement(Col,{lg:12,className:\"text-center\"},/*#__PURE__*/React.createElement(\"a\",{className:\"btn btn-primary mb-4\",download:\"certificate.pdf\",href:states.simedis_account.base64},\"Download Certificate\"),/*#__PURE__*/React.createElement(Form.Control,{type:\"text\",disabled:true,defaultValue:text,className:\"text-center\"}),/*#__PURE__*/React.createElement(CopyToClipboard,{text:text},/*#__PURE__*/React.createElement(Button,{className:\"mt-4\"},\"Copy to Clipboard\")))));}return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Card,null,/*#__PURE__*/React.createElement(Card.Header,null,\"FINISH\"),/*#__PURE__*/React.createElement(Card.Body,null,/*#__PURE__*/React.createElement(Card,null,/*#__PURE__*/React.createElement(Card.Header,null,\"Pembayaran Selesai\"),/*#__PURE__*/React.createElement(Card.Body,null,content)))));}}]);return FinishedPayment;}(Component);export default FinishedPayment;","map":{"version":3,"sources":["D:/projects/app-apd/src/Pages/Finished/index.js"],"names":["React","Component","qs","axios","moment","Loader","Alerts","CopyToClipboard","Card","Button","Row","Container","Col","Form","FinishedPayment","copyCodeToClipboard","text","el","select","document","execCommand","data","props","states","midtrans_account","updatePaymentHandler","simedisPaymentChange","updateAccountHandler","simedisAccountChange","query","parse","location","search","ignoreQueryPrefix","loadHandler","updatePageLoad","processData","order_id","orderId","getTransactionDetail","res1","registerPayment","res2","getCertificate","res3","failCase","url","process","env","REACT_APP_MIDTRANS_URL","config","auth","username","server_key","password","headers","Accept","Authorization","get","res","status","dataTransactionDetail","payment_type","transaction_id","gross_amount","transaction_time","format","console","log","dataPayment","simedis_payment","REACT_APP_PAYMENT_URL","paymentDesc","payment_desc","paymentRefCode","bill_code","billCode","amount","paid_amount","paidAmount","transactionDate","transaction_date","paymentStatus","usedReferralCode","post","ok","responseData","members","registrationCode","customer_code","accountData","simedis_account","REACT_APP_CUSTOMER_POLICIES_CERTIFICATE_URL","customerCode","registration_code","token","certificate","is_loading","width","height","display","justifyContent","alignItems","content","is_valid","base64"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport qs from \"qs\";\r\nimport axios from \"axios\";\r\nimport moment from \"moment\";\r\nimport Loader from \"react-loader-spinner\";\r\nimport Alerts from \"../../Components/Alerts\";\r\nimport { CopyToClipboard } from \"react-copy-to-clipboard\";\r\n\r\nimport { Card, Button, Row, Container, Col, Form } from \"react-bootstrap\";\r\n\r\nclass FinishedPayment extends Component {\r\n  componentDidMount() {\r\n    const data = this.props.states.midtrans_account;\r\n    const updatePaymentHandler = this.props.simedisPaymentChange;\r\n    const updateAccountHandler = this.props.simedisAccountChange;\r\n    //parsing URL\r\n    const query = qs.parse(this.props.location.search, {\r\n      ignoreQueryPrefix: true,\r\n    });\r\n    const loadHandler = this.props.updatePageLoad;\r\n    loadHandler(true);\r\n\r\n    this.processData(\r\n      query.order_id, //orderId\r\n      updatePaymentHandler,\r\n      updateAccountHandler,\r\n      loadHandler\r\n    );\r\n  }\r\n\r\n  async processData(\r\n    orderId,\r\n    updatePaymentHandler,\r\n    updateAccountHandler,\r\n    loadHandler\r\n  ) {\r\n    const res1 = await this.getTransactionDetail(\r\n      orderId,\r\n      updatePaymentHandler,\r\n      updateAccountHandler,\r\n      loadHandler\r\n    );\r\n    const res2 = await this.registerPayment(\r\n      updateAccountHandler,\r\n      updateAccountHandler,\r\n      loadHandler\r\n    );\r\n\r\n    const res3 = await this.getCertificate(updateAccountHandler, loadHandler);\r\n\r\n    if (res1 === true && res2 === true) {\r\n      loadHandler(false);\r\n    } else {\r\n      this.failCase(updateAccountHandler, loadHandler);\r\n    }\r\n  }\r\n\r\n  async getTransactionDetail(\r\n    orderId,\r\n    updatePaymentHandler,\r\n    updateAccountHandler,\r\n    loadHandler\r\n  ) {\r\n    const data = this.props.states.midtrans_account;\r\n\r\n    try {\r\n      const url = process.env.REACT_APP_MIDTRANS_URL + orderId + \"/status\";\r\n      const config = {\r\n        auth: {\r\n          username: data.server_key,\r\n          password: \"\",\r\n        },\r\n        headers: {\r\n          Accept: \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: data.server_key + \":\",\r\n        },\r\n      };\r\n\r\n      const res = await axios.get(url, config);\r\n\r\n      if (res.status != 200) {\r\n        this.failCase(updateAccountHandler, loadHandler);\r\n        return false;\r\n      }\r\n      const dataTransactionDetail = res.data;\r\n      updatePaymentHandler(\"payment_desc\", dataTransactionDetail.payment_type);\r\n      updatePaymentHandler(\"bill_code\", orderId);\r\n      updatePaymentHandler(\r\n        \"payment_ref_code\",\r\n        dataTransactionDetail.transaction_id\r\n      );\r\n      updatePaymentHandler(\"paid_amount\", dataTransactionDetail.gross_amount);\r\n      updatePaymentHandler(\r\n        \"transaction_date\",\r\n        moment(dataTransactionDetail.transaction_time).format(\"YYYY-MM-DD\")\r\n      );\r\n      return true;\r\n    } catch (err) {\r\n      console.log(err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async registerPayment(updateAccountHandler, loadHandler) {\r\n    const dataPayment = this.props.states.simedis_payment;\r\n    try {\r\n      const url = process.env.REACT_APP_PAYMENT_URL;\r\n\r\n      const data = {\r\n        paymentDesc: dataPayment.payment_desc,\r\n        paymentRefCode: dataPayment.bill_code,\r\n        billCode: dataPayment.bill_code,\r\n        amount: dataPayment.paid_amount,\r\n        paidAmount: dataPayment.paid_amount,\r\n        transactionDate: dataPayment.transaction_date,\r\n        paymentStatus: true,\r\n        usedReferralCode: \"\",\r\n      };\r\n\r\n      const res = await axios.post(url, data, \"\");\r\n\r\n      if (!res.data.ok) {\r\n        this.failCase(updateAccountHandler, loadHandler);\r\n        return false;\r\n      }\r\n      const responseData = res.data;\r\n      const members = responseData.data.members[0];\r\n\r\n      updateAccountHandler(\r\n        \"registration_code\",\r\n        responseData.data.registrationCode\r\n      );\r\n      updateAccountHandler(\"customer_code\", members.data.customer_code);\r\n\r\n      return true;\r\n    } catch (err) {\r\n      console.log(err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  async getCertificate(updateAccountHandler, loadHandler) {\r\n    try {\r\n      const accountData = this.props.states.simedis_account;\r\n      const url = process.env.REACT_APP_CUSTOMER_POLICIES_CERTIFICATE_URL;\r\n      const data = {\r\n        customerCode: accountData.customer_code,\r\n        registrationCode: accountData.registration_code,\r\n      };\r\n      const config = {\r\n        headers: {\r\n          Authorization: accountData.token,\r\n        },\r\n      };\r\n      const res = await axios.post(url, data, config);\r\n\r\n      if (!res.data.ok) {\r\n        this.failCase(updateAccountHandler, loadHandler);\r\n        return false;\r\n      }\r\n      updateAccountHandler(\"base64\", res.data.data.data.certificate);\r\n      return true;\r\n    } catch (err) {\r\n      console.log(err);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  copyCodeToClipboard = (text) => {\r\n    const el = text;\r\n    el.select();\r\n    document.execCommand(\"copy\");\r\n  };\r\n\r\n  failCase(updateAccountHandler, loadHandler) {\r\n    updateAccountHandler(\"is_valid\", false);\r\n    updateAccountHandler(\r\n      \"form_status\",\r\n      \"Mohon maaf koneksi mengalami kendala, silahkan coba lagi\"\r\n    );\r\n    loadHandler(false);\r\n  }\r\n\r\n  render() {\r\n    const { states } = this.props;\r\n    const text = \"Bagikan ke teman anda https://bit.ly/30t7Pn3\";\r\n    if (!states || states.is_loading === true) {\r\n      return (\r\n        <Card>\r\n          <Card.Header>Loading</Card.Header>\r\n          <Card.Body>\r\n            <Loader\r\n              style={{\r\n                width: \"100%\",\r\n                height: \"100\",\r\n                display: \"flex\",\r\n                justifyContent: \"center\",\r\n                alignItems: \"center\",\r\n              }}\r\n              type=\"ThreeDots\"\r\n              color=\"#2BAD60\"\r\n              height=\"100\"\r\n              width=\"100\"\r\n            />\r\n          </Card.Body>\r\n        </Card>\r\n      );\r\n    }\r\n\r\n    let content;\r\n\r\n    if (states.simedis_account.is_valid === false) {\r\n      content = (\r\n        <Container>\r\n          <Row>\r\n            <Col lg={12} className=\"text-center\">\r\n              <Alerts\r\n                data={states.simedis_account}\r\n                valid={states.simedis_account.is_valid}\r\n              />\r\n            </Col>\r\n          </Row>\r\n        </Container>\r\n      );\r\n    } else {\r\n      content = (\r\n        <Container>\r\n          <Row>\r\n            <Col lg={12} className=\"text-center\">\r\n              Pembayaran Telah Selesai, Silahkan Cek Email Yang Anda Daftarkan\r\n              Untuk Aktivasi Account\r\n            </Col>\r\n          </Row>\r\n          <Row className=\"mt-2\">\r\n            <Col lg={12} className=\"text-center\">\r\n              <a\r\n                className=\"btn btn-primary mb-4\"\r\n                download={`certificate.pdf`}\r\n                href={states.simedis_account.base64}\r\n              >\r\n                Download Certificate\r\n              </a>\r\n              <Form.Control\r\n                type=\"text\"\r\n                disabled={true}\r\n                defaultValue={text}\r\n                className=\"text-center\"\r\n              />\r\n\r\n              <CopyToClipboard text={text}>\r\n                <Button className=\"mt-4\">Copy to Clipboard</Button>\r\n              </CopyToClipboard>\r\n            </Col>\r\n          </Row>\r\n        </Container>\r\n      );\r\n    }\r\n    return (\r\n      <div>\r\n        <Card>\r\n          <Card.Header>FINISH</Card.Header>\r\n          <Card.Body>\r\n            <Card>\r\n              <Card.Header>Pembayaran Selesai</Card.Header>\r\n              <Card.Body>{content}</Card.Body>\r\n            </Card>\r\n          </Card.Body>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default FinishedPayment;\r\n"]},"metadata":{},"sourceType":"module"}